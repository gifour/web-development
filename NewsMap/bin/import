#!/usr/bin/env php
<?php
    // TODO 0
    //It’s in this file that you’ll ultimately write a PHP script
    //that iterates over the lines in US.txt, INSERTing data from
    //each into places, that MySQL table.

    //includes
    include("../includes/config.php");
    
    //check command line arguments
    if(count($argv) != 2)
    {
        error_log("Arguments can not be processed");
        exit;
    }
    else
    {
        //check file existens and health
        if(!is_readable($argv[1]))
        {
            if(!file_exists($argv[1]))
            {
                error_log("Wrong file spacified for data import");
                exit;
            }
            else
            {
                error_log("File is not readable");
                exit;
            }
        }
        //import geographical data to 'places'
        if(($geo_file = fopen($argv[1], "r")) !== FALSE)
            while (($geo_data = fgetcsv($geo_file, 1000, "\t")) !== FALSE)
                CS50::query("INSERT INTO `places`(`country_code`, `postal_code`, `place_name`, `admin_name1`, `admin_code1`, `admin_name2`, `admin_code2`, `admin_name3`, `admin_code3`, `latitude`, `longitude`, `accuracy`)
                VALUES (?,?,?,?,?,?,?,?,?,?,?,?)", $geo_data[0], $geo_data[1], $geo_data[2], $geo_data[3], $geo_data[4], $geo_data[5], $geo_data[6], $geo_data[7], $geo_data[8], $geo_data[9], $geo_data[10], $geo_data[11]);
        
        //if FALSE then geo_data file indicator failed
        else
        {
            error_log("Memory error");
            exit;
        }
    }
?>